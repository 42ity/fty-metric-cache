# Travis CI script
language: c

os:
- linux

sudo: false

services:
- docker

env:
- BUILD_TYPE=default
- BUILD_TYPE=default-Werror
#- BUILD_TYPE=cmake
#- BUILD_TYPE=android
#- BUILD_TYPE=check-py

matrix:
  include:
  - env: BUILD_TYPE=valgrind
    os: linux
    dist: trusty
    sudo: required
    addons:
      apt:
        packages:
        - valgrind

addons:
  apt:
    packages:
    - git
    - asciidoc
    - xmlto
    - apport

before_install:
- ulimit -c
- ulimit -a -S
- ulimit -a -H
- cat /proc/sys/kernel/core_pattern

install:
- sudo apt-get install -y gdb  # install gdb

before_script:
- ulimit -c unlimited -S       # enable core dumps

# Hand off to generated script for each BUILD_TYPE
script: ./ci_build.sh

after_failure:
- COREFILE=$(find . -maxdepth 10 -name "core*" | head -n 1) # find core file ?
- echo $COREFILE
- if [[ -f "$COREFILE" ]]; then gdb -c "$COREFILE" example -ex "thread apply all bt" -ex "set pagination 0" -batch; fi
